!function(h){h(function(){(new function(){var p=this;this.init=function(){this.initCommon(),this.isSettings()&&this.processSettings(),this.isFormSettings()&&this.processFormSettings()},this.initCommon=function(){this.setupGravityForms(),this.doUploadListener(),this.doColorPicker(),this.setupSelectBoxes(),this.showTooltips(),this.setupCustomPaperSize(),this.setupToggledFields(),this.setupDynamicTemplateFields(),this.setupLicenseDeactivation()},this.setupGravityForms=function(){"undefined"!=typeof gf_vars&&(gf_vars.thisFormButton=GFPDF.conditionalText,gf_vars.show=GFPDF.enable,gf_vars.hide=GFPDF.disable)},this.isSettings=function(){return h("#tab_PDF").length},this.isFormSettings=function(){return h("#tab_pdf").length},this.isFormSettingsList=function(){return h("#gfpdf_list_form").length},this.isFormSettingsEdit=function(){return h("#gfpdf_pdf_form").length},this.getCurrentSettingsPage=function(){return this.isSettings()?h(".nav-tab-wrapper a.nav-tab-active:first").data("id"):""},this.processSettings=function(){switch(this.cleanupGFNavigation(),this.runPDFAccessCheck(),this.getCurrentSettingsPage()){case"general":this.generalSettings();break;case"tools":this.toolsSettings()}},this.processFormSettings=function(){this.isFormSettingsList()&&this.doFormSettingsListPage(),this.isFormSettingsEdit()&&this.doFormSettingsEditPage()},this.doFormSettingsEditPage=function(){this.setupRequiredFields(h("#gfpdf_pdf_form")),this.setupPdfTabs(),this.handleSecurityConditionals(),this.handlePDFConditionalLogic(),this.handleOwnerRestriction(),this.toggleFontAppearance(h("#gfpdf_settings\\[template\\]").data("template_group")),this.toggleAppearanceTab(),h("#gfpdf_pdf_form").submit(function(){try{tinyMCE.triggerSave()}catch(t){}}),h("#gfpdf_pdf_form").submit(function(){h("#gfpdf_settings\\[conditionalLogic\\]").val(jQuery.toJSON(window.gfpdf_current_pdf.conditionalLogic))})},this.handleSecurityConditionals=function(){var i=h("#pdf-general-advanced"),t=i.find('input[name="gfpdf_settings[security]"]'),e=i.find('input[name="gfpdf_settings[format]"]');t.change(function(){if(h(this).is(":checked")){var t=e.filter(":checked").val();h(this).val()===GFPDF.no||t!==GFPDF.standard?i.find("tr:nth-child(3),tr:nth-child(4),tr:nth-child(5):not(.gfpdf-hidden)").hide():i.find("tr:nth-child(3),tr:nth-child(4),tr:nth-child(5):not(.gfpdf-hidden)").show(),t!==GFPDF.standard?i.find("tr:nth-child(2)").hide():i.find("tr:nth-child(2)").show()}}).trigger("change"),e.change(function(){h(this).is(":checked")&&t.trigger("change")}).trigger("change")},this.handlePDFConditionalLogic=function(){gform.addFilter("gform_conditional_object",function(t,i){return"gfpdf"===i?window.gfpdf_current_pdf:t}),h("#gfpdf_conditional_logic").change(function(){void 0===window.gfpdf_current_pdf.conditionalLogic&&h(this).prop("checked")?window.gfpdf_current_pdf.conditionalLogic=new ConditionalLogic:h(this).prop("checked")||(window.gfpdf_current_pdf.conditionalLogic=null),ToggleConditionalLogic(!1,"gfpdf")}).trigger("change")},this.handleOwnerRestriction=function(){var t=h("#gfpdf-advanced-pdf-options");t.find('input[name="gfpdf_settings[public_access]"]').change(function(){h(this).is(":checked")&&("Yes"===h(this).val()?t.find("tr:nth-child(9)").hide():t.find("tr:nth-child(9)").show())}).trigger("change")},this.doFormSettingsListPage=function(){this.setupAJAXListDeleteListener(),this.setupAJAXListDuplicateListener(),this.setupAJAXListStateListener()},this.setupAJAXListStateListener=function(){h("#gfpdf_list_form").on("click",".check-column img",function(){var t=this;if(0<String(h(this).data("id")).length){0<=t.src.indexOf("active1.png")?(t.src=t.src.replace("active1.png","active0.png"),h(t).attr("title",GFPDF.inactive).attr("alt",GFPDF.inactive)):(t.src=t.src.replace("active0.png","active1.png"),h(t).attr("title",GFPDF.active).attr("alt",GFPDF.active));var i={action:"gfpdf_change_state",nonce:h(this).data("nonce"),fid:h(this).data("fid"),pid:h(this).data("id")};p.ajax(i,function(t){})}})},this.setupAJAXListDuplicateListener=function(){h("#gfpdf_list_form").on("click","a.submitduplicate",function(){var l=String(h(this).data("id")),f=this,t=h('<img alt="'+GFPDF.spinnerAlt+'" src="'+GFPDF.spinnerUrl+'" class="gfpdf-spinner gfpdf-spinner-small" />');if(h(this).after(t).parent().parent().attr("style","position:static; visibility: visible;"),0<l.length){var i={action:"gfpdf_list_duplicate",nonce:h(this).data("nonce"),fid:h(this).data("fid"),pid:h(this).data("id")};p.ajax(i,function(i){if(i.msg){h(f).parent().parent().attr("style","").find(".gfpdf-spinner").remove(),p.show_message(i.msg);var t=h(f).parents("tr"),e=t.clone().css("background","#baffb8");e.find(".column-name > a, .edit a").each(function(){var t=h(this).attr("href");t=p.updateURLParameter(t,"pid",i.pid),h(this).attr("href",t)}),e.find(".column-name > a").html(i.name);var n=e.find(".duplicate a"),a=e.find(".delete a"),s=e.find(".check-column img"),o=e.find(".column-shortcode input");n.data("id",i.pid),n.data("nonce",i.dup_nonce),a.data("id",i.pid),a.data("nonce",i.del_nonce),s.data("id",i.pid),s.data("nonce",i.state_nonce);var d=o.val();d=d.replace(l,i.pid),o.val(d);var r="";r=t.hasClass("alternate")?(e.removeClass("alternate"),"#FFF"):(e.addClass("alternate"),"#f9f9f9");var c=s.attr("src");s.attr("title",GFPDF.inactive).attr("alt",GFPDF.inactive).attr("src",c.replace("active1.png","active0.png")),e.hide().insertAfter(t).fadeIn().animate({backgroundColor:r})}})}})},this.maybeShowEmptyRow=function(){var t=h("#gfpdf_list_form tbody");if(0===t.find("tr").length){var i=h("<tr>").addClass("no-items"),e=h("<td>").attr("colspan","5").addClass("colspanchange"),n=h("<a>").attr("href",h("#add-new-pdf").attr("href")).append(GFPDF.letsGoCreateOne+".");e.append(GFPDF.thisFormHasNoPdfs).append(" ").append(n),i.append(e),t.append(i)}},this.setupAJAXListDeleteListener=function(){var e=h("#delete-confirm"),t=[{text:GFPDF.delete,click:function(){e.wpdialog("close"),$elm=h(e.data("elm"));var t=h('<img alt="'+GFPDF.spinnerAlt+'" src="'+GFPDF.spinnerUrl+'" class="gfpdf-spinner gfpdf-spinner-small" />');$elm.append(t).parent().parent().attr("style","position:static; visibility: visible;");var i={action:"gfpdf_list_delete",nonce:$elm.data("nonce"),fid:$elm.data("fid"),pid:$elm.data("id")};p.ajax(i,function(t){t.msg&&($elm.parent().parent().attr("style","").find(".gfpdf-spinner").remove(),p.show_message(t.msg),$elm.parents("tr").css("background","#ffb8b8").fadeOut(400,function(){this.remove(),p.maybeShowEmptyRow()})),e.data("elm",null)})}},{text:GFPDF.cancel,click:function(){e.wpdialog("close").data("elm",null)}}];this.wp_dialog(e,t,300,175),h("#gfpdf_list_form").on("click","a.submitdelete",function(){0<String(h(this).data("id")).length&&!e.data("elm")&&(p.resizeDialogIfNeeded(e,300,175),e.wpdialog("open").data("elm",this))})},this.setupPdfTabs=function(){h(".gfpdf-tab-container").not(":eq(0)").hide(),h(".gfpdf-tab-wrapper a").click(function(){return h(this).parents("ul").find("a").removeClass("current"),h(this).addClass("current").blur(),h(".gfpdf-tab-container").hide(),h(h(this).attr("href")).show(),!1})},this.setupToggledFields=function(){h("form").off("change",".gfpdf-input-toggle").on("change",".gfpdf-input-toggle",function(){var t=h(this).parent().next();h(this).prop("checked")?t.slideDown("slow"):(t.slideUp("slow"),t.find(".wp-editor-area").each(function(){var t=tinyMCE.get(h(this).attr("id"));null!==t&&t.setContent("")}),t.find("textarea").each(function(){h(this).val("")}))})},this.setupDynamicTemplateFields=function(){h("#gfpdf_settings\\[template\\]").off("change").change(function(){var i=h('<img alt="'+GFPDF.spinnerAlt+'" src="'+GFPDF.spinnerUrl+'" class="gfpdf-spinner" />');h(this).next().after(i);var t={action:"gfpdf_get_template_fields",nonce:GFPDF.ajaxNonce,template:h(this).val(),type:h(this).attr("id"),id:h("#gform_id").val(),gform_pdf_id:h("#gform_pdf_id").val()};p.ajax(t,function(t){i.remove(),h('input[name="gfpdf_settings[advanced_template]"][value="No"]').prop("checked",!0).trigger("change"),t.fields?(h.each(t.editors,function(t,i){var e=tinyMCE.get(i);if(null!==e)try{tinyMCE.remove(e)}catch(t){}}),h("#pdf-custom-appearance").hide().html(t.fields).fadeIn(),h("#gfpdf-custom-appearance-nav").show(),p.loadTinyMCEEditor(t.editors,t.editor_init),p.initCommon(),p.doMergetags()):(h("#gfpdf-custom-appearance-nav").hide(),h("#pdf-custom-appearance").html("")),t.template_type&&p.toggleFontAppearance(t.template_type),h(document).trigger("gfpdf_template_loaded",[t])})})},this.setupLicenseDeactivation=function(){h(".gfpdf-deactivate-license").click(function(){var i=h(this).parent();i.find(".gf_settings_description label").html("");var e=h('<img alt="'+GFPDF.spinnerAlt+'" src="'+GFPDF.spinnerUrl+'" class="gfpdf-spinner" />');h(this).append(e);var n=h(this).data("addon-name"),t={action:"gfpdf_deactivate_license",addon_name:n,license:h(this).data("license"),nonce:h(this).data("nonce")};return p.ajax(t,function(t){e.remove(),t.success?(h("#gfpdf_settings\\[license_"+n+"\\]").val(""),h("#gfpdf_settings\\[license_"+n+"_message\\]").val(""),h("#gfpdf_settings\\[license_"+n+"_status\\]").val(""),i.find("i").remove(),i.find("a").remove(),i.find(".gf_settings_description label").html(t.success)):i.find(".gf_settings_description label").html(t.error)}),!1})},this.toggleFontAppearance=function(t){var i=h("#pdf-general-appearance").find("tr.gfpdf_font_type, tr.gfpdf_font_size, tr.gfpdf_font_colour");"legacy"==t?i.hide():i.show()},this.toggleAppearanceTab=function(){h('input[name="gfpdf_settings[advanced_template]"]').change(function(){"Yes"==h(this).val()?h("#gfpdf-appearance-nav").hide():h("#gfpdf-appearance-nav").show()}),h('input[name="gfpdf_settings[advanced_template]"]:checked').trigger("change")},this.loadTinyMCEEditor=function(t,e){null!=e&&(e.body_class="id post-type-post post-status-publish post-format-standard",e.formats={alignleft:[{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li",styles:{textAlign:"left"}},{selector:"img,table,dl.wp-caption",classes:"alignleft"}],aligncenter:[{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li",styles:{textAlign:"center"}},{selector:"img,table,dl.wp-caption",classes:"aligncenter"}],alignright:[{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li",styles:{textAlign:"right"}},{selector:"img,table,dl.wp-caption",classes:"alignright"}],strikethrough:{inline:"del"}},e.content_style='body#tinymce { max-width: 100%; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;}'),h.each(t,function(t,i){e.selector="#"+i,tinyMCE.init(e),tinyMCE.execCommand("mceAddEditor",!1,i),"function"==typeof QTags&&(QTags({id:i}),QTags._buttonsInit(),"function"==typeof switchEditors.switchto&&switchEditors.switchto(jQuery("#wp-"+i+"-wrap").find(".wp-switch-editor.switch-"+("html"==getUserSetting("editor")?"html":"tmce"))[0]))})},this.doUploadListener=function(){var e;window.formfield="",h("body").off("click",".gfpdf_settings_upload_button").on("click",".gfpdf_settings_upload_button",function(t){t.preventDefault();var i=h(this);window.formfield=h(this).parent().prev(),e||(e=wp.media.frames.file_frame=wp.media({title:i.data("uploader-title"),button:{text:i.data("uploader-button-text")},multiple:!1})).on("select",function(){e.state().get("selection").each(function(t,i){t=t.toJSON(),window.formfield.val(t.url).change()})}),e.open()})},this.doColorPicker=function(){h(".gfpdf-color-picker").each(function(){h(this).wpColorPicker()})},this.doMergetags=function(){window.gfMergeTags&&"undefined"!=typeof form&&0<=h(".merge-tag-support").length&&h(".merge-tag-support").each(function(){new gfMergeTagsObj(form,h(this))})},this.setupCustomPaperSize=function(){h(".gfpdf_paper_size").each(function(){var t=h(this).nextAll(".gfpdf_paper_size_other").first();h(this).find("select").off("change").change(function(){"CUSTOM"===h(this).val()?t.fadeIn():t.fadeOut()}).trigger("change")})},this.cleanupGFNavigation=function(){h("#gform_tabs a").each(function(){var t=h(this).attr("href"),i=new RegExp("&tab=[^&;]*","g");h(this).attr("href",t.replace(i,""))})},this.runPDFAccessCheck=function(){var i=h("#gfpdf-direct-pdf-protection-check");if(0<i.length){var e=h('<img alt="'+GFPDF.spinnerAlt+'" src="'+GFPDF.spinnerUrl+'" class="gfpdf-spinner" />');i.append(e);var t={action:"gfpdf_has_pdf_protection",nonce:i.data("nonce")};this.ajax(t,function(t){e.remove(),!0===t?i.find("#gfpdf-direct-pdf-check-protected").show():i.find("#gfpdf-direct-pdf-check-unprotected").show()})}},this.setupRequiredFields=function(t){t.attr("novalidate","novalidate"),t.find('tr input[type="submit"]').click(function(){t.addClass("formSubmitted")}),t.find("tr").each(function(){h(this).find(':input[required=""]:first, :input[required]:first').parents("tr").find("th").append('<span class="gfield_required">*</span>')})},this.showTooltips=function(){"function"==typeof gform_initialize_tooltips&&(h(".gf_hidden_tooltip").each(function(){h(this).parent().siblings("th:first").append(" ").append(p.get_tooltip(h(this).html())),h(this).remove()}),gform_initialize_tooltips())},this.setupSelectBoxes=function(){var t=h(".gfpdf-chosen"),i={disable_search_threshold:5,width:"100%"};h("body").hasClass("rtl")&&(t.addClass("chosen-rtl"),i.rtl=!0),t.each(function(){h(this).chosen(i)})},this.setup_advanced_options=function(){var t=h(".gfpdf-advanced-options"),e=t.prev();t.find("a").click(function(){var i=this;return e.slideToggle(600,function(){var t=h(i).text();h(i).text(t==GFPDF.showAdvancedOptions?GFPDF.hideAdvancedOptions:GFPDF.showAdvancedOptions)}),!1}),h(".gfpdf-advanced-options").prev().find(".gfield_error").length&&e.show()},this.generalSettings=function(){this.setupRequiredFields(h("#pdfextended-settings > form"));var t=h("#pdf-general-security");t.find('input[name="gfpdf_settings[default_restrict_owner]"]').change(function(){h(this).is(":checked")&&("Yes"===h(this).val()?t.find("tr:nth-child(3)").hide():t.find("tr:nth-child(3)").show())}).trigger("change"),this.setup_advanced_options()},this.toolsSettings=function(){this.setupToolsTemplateInstallerDialog(),this.setupToolsFontsDialog(),this.setupToolsUninstallDialog()},this.setupToolsTemplateInstallerDialog=function(){var t=h("#gfpdf_settings\\[setup_templates\\]"),i=h("#setup-templates-confirm"),e=[{text:GFPDF.continue,click:function(){t.unbind().click()}},{text:GFPDF.cancel,click:function(){i.wpdialog("close")}}];i.length&&(this.wp_dialog(i,e,500,350),t.click(function(){return p.resizeDialogIfNeeded(i,500,350),i.wpdialog("open"),!1}))},this.setupToolsFontsDialog=function(){var t=h("#gfpdf_settings\\[manage_fonts\\]"),i=h("#manage-font-files");this.wp_dialog(i,[],500,500),t.click(function(){return p.resizeDialogIfNeeded(i,500,500),i.wpdialog("open"),!1}),window.location.hash&&"#manage_fonts"==window.location.hash&&t.click()},this.setupToolsUninstallDialog=function(){var t=h("#gfpdf-uninstall"),i=h("#uninstall-confirm"),e=[{text:GFPDF.uninstall,click:function(){t.parents("form").submit()}},{text:GFPDF.cancel,click:function(){i.wpdialog("close")}}];this.wp_dialog(i,e,500,175),t.click(function(){return p.resizeDialogIfNeeded(i,500,175),i.wpdialog("open"),!1})},this.resizeDialogIfNeeded=function(t,i,e){var n=h(window).width(),a=h(window).height(),s=n<500?n-20:i,o=a<500?a-50:e;t.wpdialog("option","width",s),t.wpdialog("option","height",o)},this.wp_dialog=function(t,i,e,n){t.wpdialog({autoOpen:!1,resizable:!1,draggable:!1,width:e,height:n,modal:!0,dialogClass:"wp-dialog",zIndex:3e5,buttons:i,open:function(){h(this).siblings(".ui-dialog-buttonpane").find("button:eq(1)").focus(),h(".ui-widget-overlay").bind("click",function(){t.wpdialog("close")})}})},this.get_tooltip=function(t){var i=h("<a>"),e=h('<i class="fa fa-question-circle">');return i.append(e),i.addClass("gf_tooltip tooltip"),i.click(function(){return!1}),i.attr("title",t),i},this.ajax=function(t,i){h.ajax({type:"post",dataType:"json",url:GFPDF.ajaxUrl,data:t,success:i,error:this.ajax_error})},this.ajax_error=function(t,i,e){console.log(i),console.log(e)},this.show_message=function(t,i,e){i=void 0!==i?i:4500,e=void 0!==e&&e;var n=h('<div id="message">').html("<p>"+t+"</p>");!0===e?n.addClass("error"):n.addClass("updated"),h(".wrap > h2").after(n),setTimeout(function(){n.slideUp()},i)},this.updateURLParameter=function(t,e,n){var a="",s=t.split("?"),o=s[0],d=s[1],r="";if(d)for(s=d.split("&"),i=0;i<s.length;i++)s[i].split("=")[0]!=e&&(a+=r+s[i],r="&");return o+"?"+a+r+e+"="+n}}).init()})}(jQuery);