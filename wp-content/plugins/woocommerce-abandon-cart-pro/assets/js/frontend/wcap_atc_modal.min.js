var $thisbutton,$wcap_button,wcap_product_cart_link,wcap_add_to_cart_id,wcap_add_to_cart_pro_id,wcap_add_to_cart_variation_id;jQuery(function(a){a(document).ready(function(){var a=localStorage.getItem("wcap_popup_displayed_next_time");null!=a&&(new Date).getTime()>a&&(localStorage.removeItem("wcap_popup_displayed_next_time"),localStorage.removeItem("wcap_popup_displayed"))});var t="",_={wcap_heading_section_text_email:wcap_atc_modal_param.wcap_atc_head,wcap_text_section_text_field:wcap_atc_modal_param.wcap_atc_text,wcap_email_placeholder_section_input_text:wcap_atc_modal_param.wcap_atc_email_place,wcap_button_section_input_text:wcap_atc_modal_param.wcap_atc_button,wcap_button_bg_color:wcap_atc_modal_param.wcap_atc_button_bg_color,wcap_button_text_color:wcap_atc_modal_param.wcap_atc_button_text_color,wcap_popup_text_color:wcap_atc_modal_param.wcap_atc_popup_text_color,wcap_popup_heading_color:wcap_atc_modal_param.wcap_atc_popup_heading_color,wcap_non_mandatory_modal_input_text:wcap_atc_modal_param.wcap_atc_non_mandatory_input_text,wcap_atc_button:{backgroundColor:wcap_atc_modal_param.wcap_atc_button_bg_color,color:wcap_atc_modal_param.wcap_atc_button_text_color},wcap_atc_popup_text:{color:wcap_atc_modal_param.wcap_atc_popup_text_color},wcap_atc_popup_heading:{color:wcap_atc_modal_param.wcap_atc_popup_heading_color}};a(document.body).on("wc_fragments_refreshed",function(t){if(t.target.innerHTML.indexOf("button wc-forward")>=0){var _=localStorage.getItem("wcap_popup_displayed");if(void 0===typeof _||"yes"!=_){localStorage.setItem("wcap_popup_displayed","yes");var o=new Date;o.setHours(o.getHours()+24),localStorage.setItem("wcap_popup_displayed_next_time",o.getTime());var e={wcap_atc_email:localStorage.getItem("wcap_hidden_email_id"),wcap_atc_user_action:localStorage.getItem("wcap_atc_user_action"),action:"wcap_atc_store_guest_email"};a.post(wc_add_to_cart_params.wc_ajax_url.toString().replace("%%endpoint%%","wcap_atc_store_guest_email"),e,function(a,t,_){"success"===t&&a&&localStorage.setItem("wcap_abandoned_id",a)})}}});var o=function(){a(document).on("click",".add_to_cart_button",this.wcap_on_shop_add_to_cart).on("added_to_cart",this.updateButton).on("added_to_cart",this.updateCartPage).on("added_to_cart",this.updateFragments).on("click",".wcap_popup_button",this.wcap_add_to_cart_from_shop).on("click",".wcap_popup_non_mandatory_button",this.wcap_add_product_to_cart).on("click",".wcap_popup_close",c),a(document).keydown(function(a){27==a.keyCode&&c()})};function e(){var t=$thisbutton.attr("data-product_id");if(void 0!==$thisbutton&&$thisbutton.is(".ajax_add_to_cart")){if(!t){var _=$thisbutton.attr("href"),o="",e="";if(void 0!==_)o=_;else{if(!((_=$thisbutton.find("a")).length>0))return!0;o=a(_[0]).attr("href")}if(void 0===o||""===o)return!0;e=(o=o.split("?"))[1].split("&");for(var p in e)if(-1!==e[p].indexOf("add-to-cart")){t=e[p].replace("add-to-cart=","");break}}$thisbutton.removeClass("added"),$thisbutton.addClass("loading");var d={};$thisbutton.attr("data-product_id")?a.each($thisbutton.data(),function(a,t){d[a]=t}):(d.product_id=t,d.quantity="1"),a("#wcap_checkbox_status").length>0&&a("#wcap_user_ref").length>0&&(d.wcap_checkbox_status=a("#wcap_checkbox_status").val(),d.wcap_user_ref=a("#wcap_user_ref").val()),a(document.body).trigger("adding_to_cart",[$thisbutton,d]),a.post(wc_add_to_cart_params.wc_ajax_url.toString().replace("%%endpoint%%","add_to_cart"),d,function(_){if(_)if(_.error&&_.product_url)window.location=_.product_url;else if(c(),"yes"!==wc_add_to_cart_params.cart_redirect_after_add){if("yes"==wcap_atc_modal_param.wcap_ajax_add){a(document.body).trigger("added_to_cart",[_.fragments,_.cart_hash,$thisbutton]),$thisbutton.removeClass("loading"),$thisbutton.addClass("added"),localStorage.setItem("wcap_popup_displayed","yes");var o=new Date;o.setHours(o.getHours()+24),localStorage.setItem("wcap_popup_displayed_next_time",o.getTime())}if("no"==wcap_atc_modal_param.wcap_ajax_add){var e=localStorage.getItem("wcap_popup_displayed");return void 0!==typeof e&&"yes"==e||localStorage.setItem("wcap_popup_displayed","no"),void(window.location=window.location.pathname+"?add-to-cart="+$thisbutton.attr(t))}"checked"===localStorage.getItem("wcap_checkbox_status")&&(console.log("Here"),console.log(localStorage),FB.AppEvents.logEvent("MessengerCheckboxUserConfirmation",null,{app_id:wcap_fb_params.aid,page_id:wcap_fb_params.pid,ref:"",user_ref:localStorage.getItem("wcap_user_ref")}))}else{if(null===wc_add_to_cart_params.cart_url)var p="/cart";else p=wc_add_to_cart_params.cart_url;window.location=p}})}}function c(){a(document.body).removeClass("wcap-atc-modal-open wcap-modal-loading"),a(".wcap-modal, .wcap-modal-overlay").remove()}o.prototype.wcap_on_shop_add_to_cart=function(t){var o=this.getAttribute("class");if(-1==o.indexOf("product_type_variable")&&-1==o.indexOf("product_type_booking")){t.preventDefault(),$thisbutton=a(this),$wcap_button=a(this),wcap_product_cart_link=this.getAttribute("href");var c=localStorage.getItem("wcap_popup_displayed");void 0!==typeof c&&"yes"==c||""!=wcap_atc_modal_param.wcap_populate_email?(""!=wcap_atc_modal_param.wcap_populate_email&&(localStorage.setItem("wcap_hidden_email_id",wcap_atc_modal_param.wcap_populate_email),localStorage.setItem("wcap_atc_user_action","yes")),e()):function(){a(document.body).addClass("wcap-atc-modal-open").append('<div class="wcap-modal-overlay"></div>'),a(document.body).append('<div class="wcap-modal" style="overflow-y:auto; max-height:90%;"><div class="wcap-modal__contents"> '+wcap_atc_modal_param.wcap_atc_modal_data+" </div> </div>"),function(){a(".wcap-modal__body").removeProp("style");var t=a(".wcap-modal__header").outerHeight(),_=a(".wcap-modal").height(),o=a(".wcap-modal").width(),e=a(".wcap-modal__body").outerHeight()+t;a(".wcap-modal").css({"margin-left":-o/2,"margin-top":-_/2}),_<e-5&&a(".wcap-modal__body").height(_-t)}(),a(document.body).trigger("wcap_after_atc_load");new Vue({el:"#wcap_popup_main_div",data:_});a(".wcap_popup_button").prop("disabled",!0),a("#wcap_popup_input").on("input",function(t){var _=a("#wcap_popup_input").val(),o=a(".wcap_popup_button").is(":disabled");_.length>0&&1==o?a(".wcap_popup_button").prop("disabled",!1):0==_.length&&0==o&&a(".wcap_popup_button").prop("disabled",!0)})}()}},o.prototype.wcap_add_to_cart_from_shop=function(_){_.preventDefault();var o=a("#wcap_popup_input").val();new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i).test(o)?(t=a("#wcap_popup_input").val(),localStorage.setItem("wcap_hidden_email_id",t),localStorage.setItem("wcap_atc_user_action","yes"),e()):(a("#wcap_placeholder_validated_msg").text(wcap_atc_modal_param.wcap_mandatory_email_text),a("#wcap_placeholder_validated_msg").fadeIn(),setTimeout(function(){a("#wcap_placeholder_validated_msg").fadeOut()},3e3))},o.prototype.updateButton=function(t,_,o,e){if(e=void 0!==e&&e){if(e.removeClass("loading"),e.addClass("added"),!wc_add_to_cart_params.is_cart&&0===e.parent().find(".added_to_cart").length){e.after(' <a href="'+wc_add_to_cart_params.cart_url+'" class="added_to_cart wc-forward" title="'+wc_add_to_cart_params.i18n_view_cart+'">'+wc_add_to_cart_params.i18n_view_cart+"</a>");var c=localStorage.getItem("wcap_popup_displayed");if(void 0===typeof c||"yes"!=c){localStorage.setItem("wcap_popup_displayed","yes");var p=new Date;p.setHours(p.getHours()+24),localStorage.setItem("wcap_popup_displayed_next_time",p.getTime());var d={wcap_atc_email:localStorage.getItem("wcap_hidden_email_id"),wcap_atc_user_action:localStorage.getItem("wcap_atc_user_action"),action:"wcap_atc_store_guest_email"};a.post(wc_add_to_cart_params.wc_ajax_url.toString().replace("%%endpoint%%","wcap_atc_store_guest_email"),d,function(a,t,_){"success"===t&&a&&localStorage.setItem("wcap_abandoned_id",a)})}}a(document.body).trigger("wc_cart_button_updated",[e])}},o.prototype.updateCartPage=function(){var t=window.location.toString().replace("add-to-cart","added-to-cart");a(".shop_table.cart").load(t+" .shop_table.cart:eq(0) > *",function(){a(".shop_table.cart").stop(!0).css("opacity","1").unblock(),a(document.body).trigger("cart_page_refreshed")}),a(".cart_totals").load(t+" .cart_totals:eq(0) > *",function(){a(".cart_totals").stop(!0).css("opacity","1").unblock(),a(document.body).trigger("cart_totals_refreshed")})},o.prototype.updateFragments=function(t,_){_&&(a.each(_,function(t){a(t).addClass("updating").fadeTo("400","0.6").block({message:null,overlayCSS:{opacity:.6}})}),a.each(_,function(t,_){a(t).replaceWith(_),a(t).stop(!0).css("opacity","1").unblock()}),a(document.body).trigger("wc_fragments_loaded"))},o.prototype.wcap_add_product_to_cart=function(t){if("off"==wcap_atc_modal_param.wcap_atc_mandatory_email)t.preventDefault(),localStorage.setItem("wcap_atc_user_action","no"),e();else{t.preventDefault();var _=a("#wcap_popup_input").val(),o=wcap_atc_modal_param.wcap_mandatory_text;_&&(o=wcap_atc_modal_param.wcap_mandatory_email_text),a("#wcap_placeholder_validated_msg").text(o),a("#wcap_placeholder_validated_msg").fadeIn(),setTimeout(function(){a("#wcap_placeholder_validated_msg").fadeOut()},3e3)}},new o});